var express = require('express');
const session = require('express-session');
const { response } = require('../app');
var router = express.Router();
const productHelper=require('../helpers/product-helpers');
const userHelpers = require('../helpers/user-helpers');
const userHelper=require('../helpers/user-helpers')

const verifyLogin=(req,res,next)=>{
  if(req.session.loggedIn){
    next()
  }else{
    res.redirect('/login')
  }
}

/* GET home page. */
router.get('/', async function(req, res, next) {
  let user=req.session.user
  console.log(user)
  let cartCount=null
  if(req.session.user){
    cartCount=await userHelpers.getCartCount(req.session.user._id)
  }
  

  /*
  let products=[
    {
      name:'IPHONE 11',
      category:'Mobile',
      description:'The iPhone 11 display has rounded corners that follow a beautiful curved design, and these corners are within a standard rectangle.',
      image:'data:image/jpeg;base64,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'
    },
    {
      name:'OnePlus Nord',
      category:'Mobile',
      description:'The iPhone 11 display has rounded corners that follow a beautiful curved design, and these corners are within a standard rectangle.',
      image:'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSJ5BAAQLFTEufo8E50jl0lNz4aUex_oUflmA&usqp=CAU'
    },
    {
      name:'OPPO F19 Pro',
      category:'Mobile',
      description:'The iPhone 11 display has rounded corners that follow a beautiful curved design, and these corners are within a standard rectangle.',
      image:'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoHCBIQEhISEQ8SEg8REhUREREREhEPERISGBgaGhgUGBkcIS4lHB4rHxgYJjgmLS8xNTU1GiU+QDszPy40NTEBDAwMEA8QHhISHzQrJCw0NDQ0NDQ0NDQ0MTQ0MUA0MTQ0NDQ0NDQ0NDQxNDQ0NDQ0NDQxMTQ0NDQ0NDQ0NDQ0NP/AABEIAPQAzgMBIgACEQEDEQH/xAAcAAEAAQUBAQAAAAAAAAAAAAAACAECBAUGAwf/xABIEAACAQICBAUQBgoCAwAAAAAAAQIDEQQFBhIhMRNBUWFxFyIyNHJzdIGRk6GxsrPR0gc1U1SioxRCUmJjgpLBwuEj8CQmZP/EABkBAQADAQEAAAAAAAAAAAAAAAACAwQBBf/EAC8RAAIBAwQBAgMHBQAAAAAAAAABAgMRMQQSIVHwE0EyocEiM3GRsdHhFBVhYrL/2gAMAwEAAhEDEQA/APswAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj4vF06MHOrUhThHfKclCK8bAMgHK1tP8sg7fpLlzwpVZry6p5v6RMt+2qeYrfKS2S6I749nXA5LqiZb9tU8xW+UdUPLftqnmK3yjZLob49nWg5LqiZZ9tU8xW+Up1Rcs+2qeYrfKNkuhvj2dcDkeqLlv21TzFb5R1Rct+2qeYrfKNkuhvj2dcDkJfSNlkVd4iSXG3SqWXTs2Hn1Tsp+9/l1PgNkujt0dmDjOqdlP3v8up8B1Tsp+9/l1PgNkun+QujswcZ1T8p+9/lz+Bl4DT7K8RJRhjqak9ynrU/TJW9Jza+hdHUAtjJNJpppq6a2prlLjh0AAAAAAAAAAAAtlJJNt2SV2+REfNLtIauZ4mctaSw8JONCnt1YwTsp245S5ee3Efc9IpOODxbW9Yas108HIjng+xk+Ozd+iy9U2aKCXLKK7fCPVztsc1db1GOtbpdy+CUt0/wr4mmoTu5a85R2tbFfbe20yMsqycmnxNLyp7PQiyNVya/yQlSSRs+C/f8ALD/YcOXfv2bmuVeVeU9oOOrK7etbrEtzfOebexd1Ff1PVfoky25VY82ijReWMkRKAMAFrRz+aYWNOSaTUZXslaya3ro2rynQnR6EwU61ZSk4rgk7pJ3anb+7K6lNTViSq+knI+WrVs9rvxbFZ9JWhSlUko04uc5O0YRTlKT5EltZIJ4OPFW8sf8AZT9GqR7GUZdEtV+m3rKf6Zd/Ih/cP9fn/BrMp0Iy5UKKr4KMsQqUOGk6lZ3q6q190rdlfcX4/wCjnLa0GqdKeGqPsZ06lSVnxXjOTTXMrdJmvETp9nGUelbH0PczIo47nLXSj0ZPXq3vuZz/ANG2c4nAY6pk+Mm5xV/0eTbdnbWWq3+rKO23E/GfYT4XndX/ANhyycd8o4fWtx/8tRepJH3QyVFZnr0JudNSYABAuAAAAAAAAANXpL2ljPBa3u5Ed8u3f1f4Eh9Je0sZ4LW93IjvgZWi3yKXp1DTp8MzV8o8cTl8HJy1nFvfZtX6bGRhMNCC63bzmilKVSUnKdrSsk20uyS/vfxGwyqq23Fu9v8AfwOwlHdjPudnCSjnB9ByDRyjicNOrOctdOSvGSiqduXxbdvMckt2+9qkVdbmteO1F93ZpSajJWkk2lJcjXGWtbF3cfbiWRi0227/AEK5NNJJfyULWXFrLSotZQqygANxozW1KlR3300vxmmM3Kp6s59wvWx7ohUV4NHXrHPlPWGYvlOdeI5x+klqsYfSOrp5lxN7HvT2plzjTnti+Dl+7tj/AE/A5aOK5z3p41rjO7ENjWDBzGMlnuWKVr2o2ad01wtTaffiPNSvr53lr5OBX5k/iSGPN1CtNrzB7Ok+5j57sAAoNIAAAAAAAABqtJ+0cZ4LW93Ijhhqurv3Pf8A98fqJFaX1HDAYtq13RnHbySWq/Q2RwRp0+GZtRlCtl0ZScqdRLW2tXSfkZmYLCRprsk33SMQpYtVOKd0ip1JNWZtXOPHKK6ZRQ177ty3Pdd2tfoV/Lbk2+VKSaTsr8fSX3LCNyrLWw2UbOnCjKFLgAqZ+TYOpXnONKGvONNT1U4puKdna+97Vs3muudBoVV1MRJ/wbfiRCbtG6OPDMKtrQk4TjKE49lCacJLpT2os4U+lYqhRxUNSvBTtsjNdbOHPGS2ro3PjTOG0g0eqYP/AJIvhMM3ZVErODe6M1xPivufM3YU66lx7lSSeDXcKVjWMLXHCGlMlsPXAS1s5y7u6S/MkSTIw4Gs45ng5rfFwkr7rqUmiTx52p+8b8wjfQ4gl5lgAGcuAAAAAAAAANHpp9X4vvT9aI4okdpp9X4vvT9aI4o1afDMuoyi4FAXlBk4We9cu1GTc10ZWafIZ2tc6gVbLWyjZRs6CtyguUucuCpt9G56tSb/AIaXpNPc6DQnD06mIqRqJuHBXspOLupK21dLK6rtBsNXTR1GHxPObXD4hSTjNKUJpxnCSUoyi9ji096LZZBTe2lVnB8k7Tj0XSTXpMOpQqUJJVI2v2MlthLof9t5hUoywZ3GUeTkNLcg/Q5qpTu8LVlaF7t057+Dk+NWTafGk09qu+d1z666dPE050KqvTqR1Zcq41JfvJpNc6R8lzHCTw1WpRqdnSm4NrdJb4zXNKLUlzM30KrkrPJfB7kY+Ad8wwvTH1yJSkWMsd8wwvTH1yJTmev8T/H6I3U/hQABQWAAAAAAAAAGq0m7Rxngtf3ciNMSS2k/aOM8Fr+7kRojuNOnwzLqMouAKmgzg96MtluT1HgZWX4SVScYqUIa8lBSm3GN27Xdk3a/McbS5ZJJvBVJu9k3ZXdley5XzFtz6FhcgxkMDPCU6VGjUqTl+k16lW7qxU7wjBQjJ6uqorrrW67ZtucLmOCqYapOlViozha6TUk01dSTXE00/gcjNN2Jyg4q54FClylyRAuN9odPVrTfJTS8skc/c3GjU7VJ97XrK6vMGjjwz6ThsVzm0hOM4uE0pQlvT9a5HznKYaubjC1zyZwsyuLPKvh3h56t7wfXU5csefnXH/s5P6SMHdYfFxXZXw9TnaTnTfkU14one4+HCUZP9an/AMkehdkvJfyI5rSWlwuXYlcdOEay5tSSk/w6y8Zr08+UxD7M1bDPm+jX1rgO/U/bZKEi7ox9a4Dv1P22SiLK/wAb89kelDAABSTAAAAAAAAANVpP2jjPBa/u5EaIkl9J+0cZ4LW93IjRHcadPhmXUZQLi0qaDOD3jWslzHgWST4iqrFtcF1GSUuT7XoxmqxWFpVG7yS4Op3cNjfjVn/MfKc0o1adarGunw3CSlNy/Xbbeunxp70zZ6FZ9HCSqwrSapVIqcWlKdpx2WsuVP8ACjX55mksXXnVkmo7IU4N31Ka3Lp2tvnbIUYyTd0TrSi0rMwri5ZcXNBQX3NlkU7Tn3MfWzU3NhlMrOf8v9yMuUceGddhapuMLVOaw0zcYWpuMdSBQdThJ6yae5xkn0NGgxPXYPFp7nhK/upGypVtSnUnyQdul7F6WjS5jU1MFjJf/NViumcdRemSI0oWuSvzE+b6L/WmA79T9tkpCLeiv1pgO/U/aJSFtb4357I9SOAACkkAAAAAAAAAarSftHGeC1vdyI0R3El9Je0sZ4LW93IjRE06fDM2oygADQZioKFQdBfcsCALrlbloAK3M/Kn2fRH/IwDY5NDWc+iP+QXJxvhm8wzN1gYt2NZhqNtraS5XsRmvHKK1afZbnU3W7nn5yE4mZu5ssdiexpRe5603+9xR8Xw5DSaa4vg8FGnfr8RUircfB07Tk/6tRfzGfgKLk1xts4rS/MlicS1B3o0FwNNrdJp9fNdMvRFHKcOUWUFuqX6MLRT60wPf6ftEpCLeif1pge/0/aZKQor/G/PZHqxwAAUkgAAAAAAAADV6S9pYzwWt7uRGeO4kxpJ2ljPBa3u5EZ47jTp8MzajKAANBmBUoACoBQHS8FADhUz8pbWvZtdhudv2jXm0yKOs6i5of5BHJP7LNpCLe9t9LubLC0LlMNhW+IszbOqeCi4Q1amKtshvhS/eqfLvfMiW0y3cntjkaS5usJS4KnL/wAqtG109tGm9jlzSe5eN8Sv8/SPXEVp1ZyqVJudSb1pzltcny/93HmTjGx6NKmqcbGfop9aYHv9P2mSkIuaKfWmB79T9olGYNR8b89kao4AAKCQAAAAAAAABq9JO0sZ4LW93IjPHcSX0l7Sxngtb3ciNEdxp0+GZtRlAAGgzAAAAAAFwLS4AG30fxVOi6k6smo6qUVGLlKUtZ7F4k99jUF8Owl3cPVM7HKG1SW1m4zDSarNOFCPAQexyveu10rZDxXfOc816dr6XvZ6tFjReoltOnGCtFFlili+xSxYolpnaK/WuA79T9pkoiL2i6tmuA79T9pkoTytVxVl+P0RdHAABnJAAAAAAAAAGq0n7Rxngtb3ciNEdxJjSXtLGeC1vdyIzo06fDM2oygADQZgAAAAAAAAAe1NdbLuo+qZ4mbgKeupq21OL8XXFlJbppHYuzMZxLHEz6lJR3yiulpGLOrSj+un3PXeo3+mlllqd8Hjql8afKecsWv1Y+OXwR5Nyn2Tvzbl5Dm+Cxz+hOzNjo3JPNcBZ3SrU1+NkoSLmi6tmmA7/S9slGeJqrurK/nCL4YAAM5IAAAAAAAAAxsfhlWpVaTdlUpzpt8ilFx/uRixOGnRqTpTi4zpzlCcXxSi7NEpjiNMtAqWYy4alPgMVZJy1danVtu11vvxXXjvsLaU1F8lVWDkuD4UDs630aZnGTUaVOaW6UasIp/1NP0Hn1N81+7Q89R+Y1epHsy+nPo5AHX9TfNfu0fP0fmHU3zX7tHz9H5hvj2PTn0cgDr+pvmv3aPn6PzDqb5r92j5+j8w3x7Hpz6OQB1/U3zX7tDz9H5ivU3zX7vDz1HZ+Ib49j059HHnliuxjHlbk/FsXrkdq/o3zS2zDQcuJSrUVHx2ld+gxJ/RdnMm24U7v+LS8m856sL88/l9Wi2nTad2cbGHMXxpnXdS7Of2KfnaXxK9TDOf2KfnaPxJqvTXt/z+5bZnLRpnrGB0q+jLOv2KfnaPxMrBfRPmdZpYirTow425xqbOZRe3xly1tKPs/l+7/Q44Nmq+jrAPGZvh3BXp4eSqyktyUOuT8crLxkkTndEdFMPlVJ06Kcqk7OrWlbXm1uXNFbbL1nRHmVajqScn55gtSsAAVnQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/9k='
    },
    {
      name:'Redmi Note 10 Pro',
      category:'Mobile',
      description:'The iPhone 11 display has rounded corners that follow a beautiful curved design, and these corners are within a standard rectangle.',
      image:'data:image/jpeg;base64,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'
    }
  ]
  */

  productHelper.getAllProducts().then((products)=>{
    console.log(products);
    res.render('user/view-products',{products,user,cartCount})
  })
  
});
router.get('/login',(req,res)=>{
  if(req.session.loggedIn){
    res.redirect('/')
  }else{
    res.render('user/login',{'loginErr':req.session.loginErr})
    req.session.loginErr=false
  }
  
});
router.get('/signup',(req,res)=>{
  res.render('user/signup')
});
router.post('/signup',(req,res)=>{
  userHelpers.doSignup(req.body).then((response)=>{
    console.log(response)
    req.session.loggedIn=true
    req.session.user=response
    res.redirect('/')
  })
});
router.post('/login',(req,res)=>{
  userHelpers.doLogin(req.body).then((response)=>{
    if(response.status){
      req.session.loggedIn=true

      req.session.user=response.user
      res.redirect('/')
    }else{
      req.session.loginErr='Invalid user name or password'
      res.redirect('/login')
    }
  
  })
});
router.get('/logout',(req,res)=>{
  req.session.destroy()
  res.redirect('/')
});
router.get('/cart',verifyLogin,async(req,res)=>{
  let products=await userHelpers.getCartProducts(req.session.user._id)
  console.log(products);
  res.render('user/cart',{products,user:req.session.user})
});
router.get('/add-to-cart/:id',verifyLogin,(req,res)=>{
  console.log('api call');
  userHelpers.addToCart(req.params.id,req.session.user._id).then(()=>{
    res.json({status:true})
  })
});
router.post('/change-product-quantity',(req,res,next)=>{
  console.log(req.body);
  userHelpers.changeProductQuantity(req.body).then(()=>{
    console.log(req.body);
  })
})

module.exports = router;
